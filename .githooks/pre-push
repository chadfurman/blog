#!/bin/sh
# Pre-push hook: rebuild frontend/out/ before pushing
# This ensures the static export is always fresh when deploying via Vercel

echo "Pre-push: rebuilding frontend..."
cd frontend && npm run build
if [ $? -ne 0 ]; then
  echo "Build failed — push aborted."
  exit 1
fi
cd ..

# Check if out/ has changes that need to be committed
if ! git diff --quiet frontend/out/; then
  echo ""
  echo "⚠ frontend/out/ has uncommitted changes after rebuild."
  echo "  Please commit the updated build output and push again."
  echo ""
  exit 1
fi

echo "Build up to date. Pushing..."
